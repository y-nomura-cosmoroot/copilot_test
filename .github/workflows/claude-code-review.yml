name: Claude PR Auto Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  issues: read
  id-token: write

jobs:
  claude-review:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Claude Code PR Review
      uses: anthropics/claude-code-action@v1
      with:
        claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        prompt: |
          このPRを詳細にレビューしてください。以下の観点から分析してお願いします：

          ## レビュー観点
          1. **コード品質**: バグや潜在的な問題の特定
          2. **セキュリティ**: セキュリティの脆弱性やベストプラクティス
          3. **パフォーマンス**: パフォーマンスに影響する可能性のある変更
          4. **可読性**: コードの可読性と保守性
          5. **テスト**: テストカバレッジと品質
          6. **設計**: アーキテクチャと設計パターン

          ## 出力形式
          - 重要度順に問題を整理
          - 具体的な改善提案を提供
          - コード例があれば含める
          - 良い点も明記する

          変更されたファイルのみを対象に、建設的で実用的なフィードバックをお願いします。